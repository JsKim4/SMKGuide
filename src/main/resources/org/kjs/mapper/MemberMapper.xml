<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kjs.mapper.MemberMapper">
	
	<insert id="insert">
		insert into
		tbl_member(email,password,member_name,telephone,address)
		values(#{email},sha2(#{password},256),#{memberName},#{telephone},#{address})
	</insert>
	
	<insert id="insertSelectKey">
		<selectKey resultType="long" keyProperty="tobaccoId"
			order="BEFORE">
			SELECT MAX(tobacco_id)+1 FROM tbl_tobacco
		</selectKey>
		insert into
		tbl_tobacco(tobacco_name,country_id,company_id,type_id,brand_id,tar,nicotine,amount,price)
		values(#{tobaccoName},#{country.id},#{company.id},#{type.id},#{brand.id},#{tar},#{nicotine},#{amount},#{price})
	</insert>

	<delete id="delete">
		delete from tbl_tobacco where tobacco_id = #{tobaccoId}
	</delete>

	<update id="update">
		update tbl_tobacco set 
			tobacco_name = #{tobaccoName},
			country_id =  #{country.id},
			company_id = #{company.id},
			brand_id = #{brand.id},
			type_id = #{type.id},
			tar = #{tar},
			nicotine = #{nicotine},
			amount = #{amount},
			price = #{price}
		where tobacco_id = #{tobaccoId}
	</update>
	
	

	<select id="get" resultMap="Tobacco">
		select t.tobacco_id, t.tobacco_name,
		t.delete_flag, t.tar, t.nicotine, t.amount, t.price,
		t.country_id as country_id,
		ct.country_name as country_name,
		t.company_id as company_id,
		cm.company_name as company_name,
		t.type_id as type_id,
		tp.type_name as type_name,
		t.brand_id as brand_id,
		b.brand_name as brand_name

		from tbl_tobacco as t
		left join tbl_country as ct on (t.country_id =
		ct.country_id)
		left join tbl_company as cm on (t.company_id =
		cm.company_id)
		left join tbl_brand as b on (t.brand_id = b.brand_id)
		left join tbl_type as tp on (t.type_id = tp.type_id)

		where tobacco_id=#{tobaccoId}
	</select>

	<select id="getList" resultMap="Tobacco">
		select t.tobacco_id, t.tobacco_name,
		t.delete_flag, t.tar, t.nicotine, t.amount, t.price,
		t.country_id as country_id,
		ct.country_name as country_name,
		t.company_id as company_id,
		cm.company_name as company_name,
		t.type_id as type_id,
		tp.type_name as type_name,
		t.brand_id as brand_id,
		b.brand_name as brand_name

		from tbl_tobacco as t
		left join tbl_country as ct on (t.country_id =
		ct.country_id)
		left join tbl_company as cm on (t.company_id =
		cm.company_id)
		left join tbl_brand as b on (t.brand_id = b.brand_id)
		left join tbl_type as tp on (t.type_id = tp.type_id)
	</select>
	
	<select id="getListWithPage" resultMap="Tobacco">
		select t.tobacco_id, t.tobacco_name,
		t.delete_flag, t.tar, t.nicotine, t.amount, t.price,
		t.country_id as country_id,
		ct.country_name as country_name,
		t.company_id as company_id,
		cm.company_name as company_name,
		t.type_id as type_id,
		tp.type_name as type_name,
		t.brand_id as brand_id,
		b.brand_name as brand_name

		from tbl_tobacco as t
		left join tbl_country as ct on (t.country_id =
		ct.country_id)
		left join tbl_company as cm on (t.company_id =
		cm.company_id)
		left join tbl_brand as b on (t.brand_id = b.brand_id)
		left join tbl_type as tp on (t.type_id = tp.type_id)
		
		order by tobacco_id desc limit #{startIndex},#{amount}
	</select>
	
	<select id="getTotalCount" resultType="int">
		select count(*) from tobacco
	</select>
	

</mapper>